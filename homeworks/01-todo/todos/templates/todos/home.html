{% extends 'todos/base.html' %}

{% block title %}TODO List - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    .filter-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 0.5rem;
    }

    .filter-tabs a {
        padding: 0.5rem 1rem;
        text-decoration: none;
        color: #6c757d;
        border-radius: 4px 4px 0 0;
        transition: all 0.3s;
    }

    .filter-tabs a:hover {
        background-color: #e9ecef;
    }

    .filter-tabs a.active {
        color: #3498db;
        background-color: #e7f3ff;
        font-weight: 600;
    }

    .stats {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        flex: 1;
        background: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
    }

    .stat-card h3 {
        font-size: 2rem;
        color: #3498db;
        margin-bottom: 0.5rem;
    }

    .stat-card p {
        color: #6c757d;
        font-size: 0.9rem;
    }

    .todo-list {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .todo-item {
        padding: 1.5rem;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: background-color 0.2s;
    }

    .todo-item:last-child {
        border-bottom: none;
    }

    .todo-item:hover {
        background-color: #f8f9fa;
    }

    .todo-item.resolved {
        opacity: 0.6;
    }

    .todo-checkbox {
        flex-shrink: 0;
    }

    .todo-content {
        flex: 1;
    }

    .todo-title {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 0.25rem;
        color: #2c3e50;
    }

    .todo-item.resolved .todo-title {
        text-decoration: line-through;
    }

    .todo-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .todo-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.85rem;
        color: #6c757d;
    }

    .todo-actions {
        display: flex;
        gap: 0.5rem;
    }

    .badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .badge-danger {
        background-color: #dc3545;
        color: white;
    }

    .badge-warning {
        background-color: #ffc107;
        color: #000;
    }

    .badge-success {
        background-color: #28a745;
        color: white;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #6c757d;
    }

    .empty-state h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .empty-state p {
        margin-bottom: 2rem;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .page-header h2 {
        font-size: 2rem;
        color: #2c3e50;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h2>My TODOs</h2>
    <a href="{% url 'todo-create' %}" class="btn btn-primary">+ Add New TODO</a>
</div>

<div class="stats">
    <div class="stat-card">
        <h3>{{ total_count }}</h3>
        <p>Total TODOs</p>
    </div>
    <div class="stat-card">
        <h3>{{ active_count }}</h3>
        <p>Active</p>
    </div>
    <div class="stat-card">
        <h3>{{ completed_count }}</h3>
        <p>Completed</p>
    </div>
</div>

<div class="filter-tabs">
    <a href="?status=all" class="{% if current_filter == 'all' %}active{% endif %}">All ({{ total_count }})</a>
    <a href="?status=active" class="{% if current_filter == 'active' %}active{% endif %}">Active ({{ active_count }})</a>
    <a href="?status=completed" class="{% if current_filter == 'completed' %}active{% endif %}">Completed ({{ completed_count }})</a>
</div>

{% if todos %}
<div class="todo-list">
    {% for todo in todos %}
    <div class="todo-item {% if todo.is_resolved %}resolved{% endif %}">
        <div class="todo-checkbox">
            <form method="post" action="{% url 'todo-toggle' todo.pk %}" style="margin: 0;">
                {% csrf_token %}
                <input type="checkbox"
                       {% if todo.is_resolved %}checked{% endif %}
                       onchange="this.form.submit()"
                       style="width: 20px; height: 20px; cursor: pointer;">
            </form>
        </div>
        <div class="todo-content">
            <div class="todo-title">{{ todo.title }}</div>
            {% if todo.description %}
            <div class="todo-description">{{ todo.description|truncatewords:20 }}</div>
            {% endif %}
            <div class="todo-meta">
                <span>Created: {{ todo.created_at|date:"M d, Y" }}</span>
                {% if todo.due_date %}
                <span>
                    Due: {{ todo.due_date|date:"M d, Y" }}
                    {% if todo.is_overdue %}
                    <span class="badge badge-danger">OVERDUE</span>
                    {% elif not todo.is_resolved %}
                    <span class="badge badge-warning">UPCOMING</span>
                    {% endif %}
                </span>
                {% endif %}
                {% if todo.is_resolved %}
                <span class="badge badge-success">COMPLETED</span>
                {% endif %}
            </div>
        </div>
        <div class="todo-actions">
            <a href="{% url 'todo-update' todo.pk %}" class="btn btn-secondary btn-sm">Edit</a>
            <a href="{% url 'todo-delete' todo.pk %}" class="btn btn-danger btn-sm">Delete</a>
        </div>
    </div>
    {% endfor %}
</div>

{% if is_paginated %}
<div style="margin-top: 2rem; text-align: center;">
    {% if page_obj.has_previous %}
    <a href="?page=1&status={{ current_filter }}" class="btn btn-secondary btn-sm">First</a>
    <a href="?page={{ page_obj.previous_page_number }}&status={{ current_filter }}" class="btn btn-secondary btn-sm">Previous</a>
    {% endif %}

    <span style="margin: 0 1rem;">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&status={{ current_filter }}" class="btn btn-secondary btn-sm">Next</a>
    <a href="?page={{ page_obj.paginator.num_pages }}&status={{ current_filter }}" class="btn btn-secondary btn-sm">Last</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="todo-list">
    <div class="empty-state">
        <h2>No TODOs Found</h2>
        <p>
            {% if current_filter == 'active' %}
            You don't have any active TODOs. Great job!
            {% elif current_filter == 'completed' %}
            You haven't completed any TODOs yet.
            {% else %}
            You haven't created any TODOs yet. Get started by adding one!
            {% endif %}
        </p>
        <a href="{% url 'todo-create' %}" class="btn btn-primary">Create Your First TODO</a>
    </div>
</div>
{% endif %}
{% endblock %}
